<!DOCTYPE html>
<html lang="jp">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ハーメルン用コード変換システム</title>
</head>

<body>
    <h1>ハーメルン用コード変換システム</h1>
    <textarea id="codeInput" rows="20" cols="50" placeholder="ここにコードを入力"></textarea>
    <br />
    <button onclick="convertPython()">Python用</button>
    <button onclick="convertHameln()">ハーメルン用</button>
    <h2>変換結果</h2>
    <button onclick="copyCode()">コピー</button>
    <br />
    <br />
    <pre id="convertedCode">
    Press the button to select the conversion format.
    </pre>

    <script>
        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function convertPython() {
            const codeInput = document.getElementById("codeInput").value;
            const coloredInput = codeInput
                .replace(
                    /(\d+)/g,
                    "《/color》《color:#b58900》$1《/color》《color:#839496》"
                )
                .replace(/\n/g, "《/color》\n《color:#839496》")
                .replace(
                    /(^| )(%|==)($| )/g,
                    "$1《/color》《color:#dc322f》$2《/color》《color:#839496》$3"
                )
                .replace(
                    /('[^']*')/g,
                    "《/color》《color:#2aa198》$1《/color》《color:#839496》"
                )
                .replace(
                    /(^| )(for|if|elif|else|in|and)($|:| )/g,
                    "$1《/color》《color:#859900》$2《/color》《color:#839496》$3"
                )
                .replace(/《color:#[\u\l\d]{6}》(\s*)《\/color》/g, "$1");
            document.getElementById("convertedCode").innerHTML =
                escapeHtml((putInBox(coloredInput)));
        }
        function convertHameln() {
            const codeInput = document.getElementById("codeInput").value;
            const coloredInput = codeInput
                .replace(/\|/g, "||@》")
                .replace(/《/g, "《|《》")
                .replace(/@/g, "《")
                .replace(/\n/g, "《/color》\n《color:#839496》")
                .replace(
                    /《\|《》(\/??)(box|text)(:??)/g,
                    "《|《》$1《/color》《color:#cb4b16》$2《/color》《color:#839496》$3"
                )
                .replace(
                    /《\|《》(\/??)(bordercolor|bgcolor|opacity|xsmall|blink|color|shake|small|speak|telop|blur|edge|fade|font|link|xbig|big|ref|sub|sup|vib|id|b|i|s|u)(:??)/g,
                    "《|《》$1《/color》《color:#2aa198》$2《/color》《color:#839496》$3"
                )
                .replace(
                    /《\|《》(\/??)(boxbordercolor|boxbgcolor|marquee|center|right|table|left|hr)(:??》)/g,
                    "《|《》$1《/color》《color:#d33682》$2《/color》《color:#839496》$3"
                )
                .replace(/《color:#839496》《\/color》/g, "")
                .replace(/《color:#[\u\l\d]{6}》 《\/color》/g, " ")
                .replace(/\$\$/g, "|$$$$《》")
            document.getElementById("convertedCode").innerHTML =
                escapeHtml(putInBox(coloredInput));
        }
        function putInBox(code) {
            return "《box:w100%,bg#073642,p1》《box:w100%,bg#002b36,p1,font61》\n《color:#839496》" +
                code +
                "《/color》\n《/box》《/box》"
        }
        function copyCode() {
            const codeElement = document.getElementById("convertedCode").innerHTML;
            const codeText = codeElement.innerText || codeElement.textContent;
            if (navigator.clipboard && window.isSecureContext) {
                // For modern browsers
                navigator.clipboard.writeText(codeText).then(() => {
                    alert("コードがクリップボードにコピーされました！");
                }, () => {
                    alert("コピーに失敗しました。ブラウザの設定を確認してください。");
                });
            } else {
                // Fallback for older browsers
                const textArea = document.createElement("textarea");
                textArea.value = codeText;
                textArea.style.position = "fixed";  // Avoid scrolling to bottom
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();

                try {
                    const successful = document.execCommand('copy');
                    const msg = successful ? "コードがクリップボードにコピーされました！" : "コピーに失敗しました。";
                    alert(msg);
                } catch (err) {
                    alert("コピーに失敗しました。エラー: " + err);
                }

                document.body.removeChild(textArea);
            }
        }
    </script>
</body>

</html>