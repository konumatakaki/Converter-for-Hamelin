<!DOCTYPE html>
<html lang="jp">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ハーメルン用コード変換システム</title>
</head>

<body>
    <h1>ハーメルン用コード変換システム</h1>
    <textarea id="codeInput" rows="20" cols="50" placeholder="ここにコードを入力"></textarea>
    <br />
    <button onclick="convertPython()">Python用</button>
    <button onclick="convertHameln()">ハーメルン用</button>
    <h2>変換結果</h2>
    <button onclick="copyCode()">コピー</button>
    <br />
    <br />
    <pre id="convertedCode">
    Press the button to select the conversion format.
    </pre>

    <script>
        const colors = {
            base03: '#002b36',
            base02: '#073642',
            base01: '#586e75',
            base00: '#657b83',
            base0: '#839496',
            base1: '#93a1a1',
            base2: '#eee8d5',
            base3: '#fdf6e3',
            yellow: '#b58900',
            orange: '#cb4b16',
            red: '#dc322f',
            magenta: '#d33682',
            violet: '#6c71c4',
            blue: '#268bd2',
            cyan: '#2aa198',
            green: '#859900'
        };

        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function convertPython() {
            const codeInput = document.getElementById("codeInput").value;
            const coloredInput = (`《color:#839496》` + codeInput + `《/color》`)
                .replace(/\n/g, `《/color》\n《color:${colors.base0}》`)
                .replace(/(import)/g, `《/color》《color:${colors.red}》$1《/color》《color:${colors.base0}》`)
                .replace(/(#\ [^《\n]*)/g, `《/color》《color:${colors.base01}》《i》$1《/i》《/color》《color:${colors.base0}》`)
                .replace(/(?<!《)(\*\*|==|!=|<=|>=|\+=|\-=|&&|\|\||=|%|\+|\-|\*|\/|and|or|not)/g, `《/color》《color:${colors.magenta}》$1《/color》《color:${colors.base0}》`)
                .replace(/\b([a-z][a-zA-Z0-9_]+)\s*(?=\()/g, `《/color》《color:${colors.blue}》$1《/color》《color:${colors.base0}》`)
                .replace(/\b([A-Z][a-zA-Z0-9_]+)\s*(?=\()/g, `《/color》《color:${colors.violet}》$1《/color》《color:${colors.base0}》`)
                .replace(/(["'`][^"'`]*["'`])/g, `《/color》《color:${colors.cyan}》$1《/color》《color:${colors.base0}》`)
                .replace(/\b(for|if|else|elif|while|do|switch|case|break|continue|return|function)\b/g, `《/color》《color:${colors.green}》$1《/color》《color:${colors.base0}》`)
                .replace(/(?<!#)(\b\d+)(\.\d+)?\b/g, `《/color》《color:${colors.yellow}》$1$2《/color》《color:${colors.base0}》`)
                .replace(/《color:#[\u\l\d]{6}》(\s*)《\/color》/gm, `$1`)

            document.getElementById("convertedCode").innerHTML =
                escapeHtml((putInBox(coloredInput)));
        }
        function convertHameln() {
            const codeInput = document.getElementById("codeInput").value;
            const coloredInput = (`《color:#839496》` + codeInput + `《/color》`)
                .replace(/\|/g, "||@》")
                .replace(/《/g, "《|《》")
                .replace(/@/g, "《")
                .replace(/\n/g, "《/color》\n《color:#839496》")
                .replace(
                    /《\|《》(\/??)(box|text)(:??)/g,
                    "《|《》$1《/color》《color:#cb4b16》$2《/color》《color:#839496》$3"
                )
                .replace(
                    /《\|《》(\/??)(bordercolor|bgcolor|opacity|xsmall|blink|color|shake|small|speak|telop|blur|edge|fade|font|link|xbig|big|ref|sub|sup|vib|id|b|i|s|u)(:??)/g,
                    "《|《》$1《/color》《color:#2aa198》$2《/color》《color:#839496》$3"
                )
                .replace(
                    /《\|《》(\/??)(boxbordercolor|boxbgcolor|marquee|center|right|table|left|hr)(:??》)/g,
                    "《|《》$1《/color》《color:#d33682》$2《/color》《color:#839496》$3"
                )
                .replace(/《color:#839496》《\/color》/g, "")
                .replace(/《color:#[\u\l\d]{6}》 《\/color》/g, " ")
                .replace(/\$\$/g, "|$$$$《》")
            document.getElementById("convertedCode").innerHTML =
                escapeHtml(putInBox(coloredInput));
        }
        function putInBox(code) {
            return "《box:w100%,bg#073642,p1,font61,lh1.2,inline》\n《box:w100%,bg#002b36,p1,font61,lh1.2,inline,pre-wrap》\n" +
                code +
                "\n《/box》\n《/box》"
        }
        function copyCode() {
            navigator.clipboard.writeText(document.getElementById("convertedCode").textContent).then(
                () => { alert("コピーされました！"); },
                () => { alert("コピーに失敗しました。"); })
        }
    </script>
</body>

</html>